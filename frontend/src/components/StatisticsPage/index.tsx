import React from 'react';
import { Chart } from 'react-google-charts';
import { Grid } from '@material-ui/core';
import { useQuery } from '@apollo/react-hooks';
import { FETCH_EXPLOITS_STATS } from '../../actions/exploitActions';
import LoadingPage from '../LoadingPage';
import ErrorPage from '../ErrorPage';
import { motion } from 'framer-motion';


const StatisticsPage: React.FC = () => {

    const fetchStats = useQuery(FETCH_EXPLOITS_STATS);

    if (fetchStats.loading) return <LoadingPage />;

    if (fetchStats.error) return <ErrorPage />;

    let categoryCount: { [key: string]: number } = {};

    fetchStats.data.exploits.forEach((e: any) => {
        e.categories.forEach((c: any) => {
            if (c in categoryCount) {
                categoryCount[c]++;
            } else {
                categoryCount[c] = 1;
            }
        })
    });

    return (
        <motion.div
            initial={{
                opacity: 0,
                y: 100
            }}
            animate={{
                opacity: 1,
                y: 0
            }}
            transition={{
                delay: 0.25,
                duration: 0.5
            }}
            style={{ width: '100%', height: '100vh' }}
        >
            <Grid direction='column' container justify='center' style={{ width: '100%', height: '100%', paddingTop: '50px' }}>
                <Grid item container justify='center'>
                    <h1>Statistics</h1>
                </Grid>
                <Grid item container justify='center'>
                    <Chart
                        width={'500px'}
                        height={'300px'}
                        chartType="PieChart"
                        loader={<div>Loading Chart</div>}
                        data={[
                            ['Category', 'Quantity'],
                            ...Object.entries(categoryCount)
                        ]}
                        options={{
                            title: 'Exploits per category for exploit.me',
                        }}
                        rootProps={{ 'data-testid': '1' }}
                    />
                </Grid>
            </Grid>
        </motion.div>
    )

}

export default StatisticsPage;