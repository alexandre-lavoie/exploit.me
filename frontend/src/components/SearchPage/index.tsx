import React, { useState } from 'react';
import { Grid, Card, CardContent, Typography, TextField, Button, CardActions } from '@material-ui/core';
import { useFetchExploits } from '../../actions/exploitActions';
import LoadingPage from '../LoadingPage';
import ErrorPage from '../ErrorPage';
import { useHistory } from 'react-router-dom';
import { motion } from 'framer-motion';
import ReactPlayer from 'react-player';

const SearchPage: React.FC = () => {
    const [exploits, loading, error] = useFetchExploits();
    const [search, setSearch] = useState('');
    const history = useHistory();

    if (!exploits || loading) return <LoadingPage />;

    if (error) return <ErrorPage />;

    return (
        <div style={{ width: '100%', height: '100vh', paddingTop: '40px' }}>
            <Grid spacing={3} container alignItems='center' justify='center'>
                <Grid item container justify='center'>
                    <TextField style={{ width: '50%' }} value={search} onChange={(e) => setSearch(e.target.value)} label='Search' variant='outlined' color='secondary' />
                </Grid>
                <Grid item container justify='center' spacing={2} xs={12}>
                    {
                        exploits.filter((e: any) => e.name.toLowerCase().includes(search.toLowerCase()) || e.description.toLowerCase().includes(search.toLowerCase())).map((e: any, i: number) => (
                            <Grid item key={i}>
                                <motion.div
                                    initial={{
                                        y: 100,
                                        opacity: 0
                                    }}

                                    animate={{
                                        y: 0,
                                        opacity: 1
                                    }}

                                    transition={{
                                        duration: 0.5
                                    }}

                                    style={{ width: '400px' }}
                                >
                                    <Card style={{ width: '400px' }}>
                                        <CardContent>
                                            <Typography style={{ paddingBottom: '20px' }} variant='h5'>{e.name}</Typography>
                                            <ReactPlayer width='100%' height='200px' url={e.video} />
                                            <Typography style={{ paddingTop: '20px' }}>{e.description.substring(0, 75)}...</Typography>
                                        </CardContent>

                                        <CardActions>
                                            <Button style={{ width: '100%' }} onClick={() => history.push(`/exploit/${e.id}`)}>More</Button>
                                        </CardActions>
                                    </Card>
                                </motion.div>
                            </Grid>
                        ))
                    }
                </Grid>
            </Grid>
        </div >
    )

}

export default SearchPage;