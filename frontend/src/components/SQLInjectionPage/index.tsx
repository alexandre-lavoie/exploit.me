import React, { useState } from 'react';
import { Grid, TextField, Button, Typography, Dialog, DialogTitle, DialogContent } from '@material-ui/core';

const SQLInjectionPage: React.FC = () => {
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');
    const [message, setMessage] = useState('');
    const [open, setOpen] = useState(false);

    return (
        <>
            <Dialog
                open={open}
                onClose={() => setOpen(false)}
            >
                <DialogTitle>Status</DialogTitle>
                <DialogContent style={{padding: '10px'}}>
                    <Typography>{message}</Typography>
                </DialogContent>
            </Dialog>
            <Grid container spacing={4} direction='column' alignItems='center' justify='center' style={{ width: '100%', height: '100vh', position: 'absolute' }}>
                <Grid item>
                    <Typography variant='h5'>SQL Injection</Typography>
                </Grid>
                <Grid item>
                    <TextField value={username} onChange={(e) => setUsername(e.target.value)} label='Username' color='secondary' variant='outlined' />
                </Grid>
                <Grid item>
                    <TextField value={password} onChange={(e) => setPassword(e.target.value)} label='Password' color='secondary' variant='outlined' type='password' />
                </Grid>
                <Grid item>
                    <Button variant='outlined' onClick={async () => {
                        const response = await fetch(`http://localhost:4000/sql-injection/`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                username: username,
                                password: password
                            })
                        });

                        const data = await response.json();

                        console.log(data);

                        if(data.errno){
                            setMessage("😲 SQL Error 😲");
                        } else if(data.length > 0 && data[0].ID === 1){
                            setMessage("🎉 Login Successful 🎉");
                        } else {
                            setMessage("❌ Wrong Password ❌");
                        }

                        setOpen(true);
                    }}>Login</Button>
                </Grid>
            </Grid>
        </>
    )
}

export default SQLInjectionPage;